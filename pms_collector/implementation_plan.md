# PMS数据采集插件实现计划

## 1. 用户故事
作为酒店管理人员，我希望能够使用一个独立的插件，在打开酒店PMS系统的相关数据页面时，自动识别页面结构，并提供一键上传按钮，方便我将PMS数据快速上传到收益管理系统，无需手动录入数据。

## 2. 文件变更
- 创建全新的插件目录结构
- `manifest.json`：插件配置文件
- `content.js`：页面识别和数据提取逻辑
- `background.js`：后台服务和右键菜单
- `popup.html`：插件管理界面
- `popup.js`：插件管理逻辑
- `styles.css`：样式文件

## 3. 伪代码/逻辑流

### 3.1 PMS页面识别
```
1. 当页面加载完成时，检查当前URL是否匹配目标PMS链接
2. 如果匹配，分析页面结构，检测是否包含报表数据
3. 如果检测到报表数据，初始化数据提取器
```

### 3.2 数据提取
```
1. 识别页面中的表格结构
2. 提取表格表头，匹配关键指标
3. 提取表格数据，转换为标准格式
4. 清洗数据，去除无效值和格式转换
```

### 3.3 一键上传功能
```
1. 在识别到的PMS页面中添加一键上传按钮
2. 在右键菜单中添加上传选项
3. 点击上传按钮时，调用API将提取的数据上传到数据库
4. 显示上传状态和结果
```

## 4. 验证标准

### 4.1 功能验证
1. 打开指定的PMS报表页面，插件自动识别并显示上传按钮
2. 点击上传按钮，数据成功上传到数据库
3. 插件管理界面显示正常

### 4.2 技术验证
1. 插件在指定的PMS页面结构下能正确识别
2. 数据提取准确率达到95%以上
3. 上传过程稳定，错误率低于5%
4. 页面性能影响最小化

## 5. 实现细节

### 5.1 插件配置
- 插件名称：PMS数据采集助手
- 插件版本：1.0.0
- 支持的PMS页面：
  - https://cmsplus.zhuzher.com/datacenter/report/forward
  - https://cmsplus.zhuzher.com/datacenter/report/operation/realtime
- 关键指标：平均房价、入住率、RevPAR、GMV、远期出租率、预定进度

### 5.2 插件管理界面
- 简洁的配置页面
- 显示当前版本和状态
- 支持API地址配置
- 支持门店ID配置
- 上传历史记录

## 6. 风险与应对

### 6.1 风险：PMS页面结构变化导致识别失败
- 应对：实现灵活的页面分析算法，支持多种结构识别

### 6.2 风险：数据提取不准确
- 应对：添加数据验证机制，允许用户手动调整提取结果

### 6.3 风险：插件性能影响页面加载
- 应对：优化代码执行，使用异步处理，避免阻塞页面渲染

### 6.4 风险：API调用失败
- 应对：添加重试机制，最多重试3次，显示详细错误信息